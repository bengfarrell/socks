<html>
<head>
    <meta charset="UTF-8">
    <title>Cloning Demo</title>
</head>
<body>
<h1>Cloning Quickly Demo</h1>
 <p>Blender crashes when we clone to quickly (fixed with a short 100ms sleep in the addon). This is a test to repro.</p>

<socks-connector showactivity></socks-connector>

<br /><br />
<button>Send</button>
<script type="module" src="../src/components/connector/index.js"></script>
<script type="module">
    import { SocketEvent } from '../src/components/connector/connectionevent.js';
    import { BlenderCommand, CURRENT_SELECTION } from '../src/blender-command';

    let conn;
    document.body.addEventListener(SocketEvent.OPEN, (event) => {
        conn = event.connection;
    });


    document.body.querySelector('button').addEventListener('click', () => {
        console.log('send queue')
        const queue = [];
        for (let c = 0; c < 100; c++) {
            queue.push(BlenderCommand.update(
                {
                    target: `cubey-${c}`,
                    template: CURRENT_SELECTION,
                    transforms: [
                        {
                            transform: 'translate',
                            x: 0, y: c * 2, z: 0,
                        }
                    ]
                }));
        }
        conn.send(queue);
    });

</script>
</body>
</html>
